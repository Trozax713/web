<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Spellbook</title>
    <style>
        /* Body and background */
        body {
            background-color: #2d3e2d;
            font-family: 'Georgia', serif;
            color: #e8f5e8;
            padding: 30px;
            line-height: 1.6;
        }

        /* Title */
        h1.title {
            font-size: 42px;
            color: #7fb069;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            margin-bottom: 30px;
        }

        /* Collapse button */
        .collapse-button {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 16px;
            background: linear-gradient(135deg, #4a6741, #5a7c50);
            color: #e8f5e8;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            border: 2px solid #7fb069;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            font-family: 'Georgia', serif;
            width: auto;
            min-width: unset;
            z-index: 1000;
        }

        .collapse-button:hover {
            background: linear-gradient(135deg, #5a7c50, #6a8c60);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        /* Master categories styling (Spell Levels) */
        .master-category {
            font-size: 28px;
            background: linear-gradient(135deg, #4a6741, #5a7c50);
            color: #e8f5e8;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 10px;
            margin: 10px 0;
            width: 100%;
            box-sizing: border-box;
            border: 2px solid #7fb069;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .master-category:hover {
            background: linear-gradient(135deg, #5a7c50, #6a8c60);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        /* Subcategories styling (Spell Names) */
        .subcategory {
            font-size: 22px;
            background: linear-gradient(135deg, #4f565f, #3a4148);
            color: #e8f5e8;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 8px;
            margin: 8px 0 0 20px;
            width: calc(100% - 40px);
            box-sizing: border-box;
            border-left: 4px solid #7fb069;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subcategory:hover {
            background: linear-gradient(135deg, #5f6570, #4a5158);
            transform: translateX(5px);
        }

        .subcategory.prepared {
            border-left: 4px solid #90c695;
            background: linear-gradient(135deg, #4a5a4f, #3a4a3f);
        }

        /* Checkbox styling */
        .spell-checkbox {
            width: 18px;
            height: 18px;
            margin: 0;
            cursor: pointer;
            accent-color: #7fb069;
            flex-shrink: 0;
        }

        .spell-content {
            flex: 1;
            cursor: pointer;
        }

        /* Prepared spells counter */
        .prepared-counter {
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #4a6741, #5a7c50);
            color: #e8f5e8;
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px solid #7fb069;
            font-family: 'Georgia', serif;
            font-size: 14px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .spell-limit-input {
            width: 40px;
            background: #2d3e2d;
            border: 1px solid #7fb069;
            color: #e8f5e8;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 14px;
            text-align: center;
        }

        /* Clear button */
        .clear-button {
            font-size: 14px;
            background: linear-gradient(135deg, #6b4741, #7c5750);
            color: #e8f5e8;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 6px;
            border: 2px solid #b06969;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            font-family: 'Georgia', serif;
            width: auto;
            min-width: unset;
            margin: 0 auto 20px auto;
            display: block;
        }

        .clear-button:hover {
            background: linear-gradient(135deg, #7c5750, #8c6760);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        /* Prepared spells category */
        .prepared-category {
            font-size: 28px;
            background: linear-gradient(135deg, #4a6741, #5a7c50);
            color: #e8f5e8;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 10px;
            margin: 10px 0 20px 0;
            width: 100%;
            box-sizing: border-box;
            border: 2px solid #90c695;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .prepared-category:hover {
            background: linear-gradient(135deg, #5a7c50, #6a8c60);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        /* Spell name styling */
        .spell-name {
            font-weight: bold;
            color: #e8f5e8;
        }

        .spell-details-text {
            font-weight: normal;
            color: #8b9e8a;
            opacity: 0.8;
        }

        /* Spell details container */
        .spell-details {
            background-color: #2a3530;
            border-radius: 8px;
            margin: 5px 0 0 40px;
            width: calc(100% - 60px);
            box-sizing: border-box;
            border: 1px solid #4a5a4f;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Individual spell field styling */
        .spell-field {
            display: flex;
            border-bottom: 1px solid #3a4540;
            transition: background-color 0.2s ease;
        }

        .spell-field:last-child {
            border-bottom: none;
        }

        .spell-field:hover {
            background-color: #354045;
        }

        .field-name {
            background-color: #4a6741;
            color: #e8f5e8;
            padding: 8px 12px;
            font-weight: bold;
            min-width: 120px;
            width: 120px;
            font-size: 14px;
            border-right: 2px solid #7fb069;
        }

        .field-value {
            padding: 8px 12px;
            flex: 1;
            font-size: 14px;
            color: #d0e0d0;
        }

        /* Special styling for description field */
        .field-value.description {
            font-size: 13px;
            line-height: 1.5;
        }

        /* Hidden elements for collapse/expand */
        .hidden {
            display: none;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            /* Reduce body padding on mobile */
            body {
                padding: 8px;
            }

            /* Make title smaller on mobile */
            h1.title {
                font-size: 28px;
                margin-bottom: 20px;
            }

            /* Collapse button mobile styling */
            .collapse-button {
                font-size: 14px;
                padding: 4px 8px;
                top: 5px;
                left: 5px;
            }

            .collapse-button:hover {
                transform: none;
            }

            /* Compact master categories on mobile */
            .master-category {
                font-size: 18px;
                padding: 4px 6px;
                margin: 6px 0;
                border-radius: 6px;
            }

            /* Compact subcategories on mobile */
            .subcategory {
                font-size: 13px;
                padding: 3px 5px;
                margin: 6px 0 0 10px;
                width: calc(100% - 20px);
                border-radius: 6px;
                gap: 5px;
            }

            .spell-checkbox {
                width: 14px;
                height: 14px;
            }

            .prepared-counter {
                font-size: 12px;
                padding: 4px 8px;
                top: 5px;
                right: 5px;
                gap: 4px;
            }

            .spell-limit-input {
                width: 30px;
                font-size: 12px;
            }

            .clear-button {
                font-size: 12px;
                padding: 4px 8px;
                margin: 0 auto 15px auto;
            }

            .clear-button:hover {
                transform: none;
            }

            .prepared-category {
                font-size: 16px;
                padding: 6px 10px;
                margin: 8px 0 12px 0;
            }

            .prepared-category:hover {
                transform: none;
            }

            /* Adjust spell details positioning */
            .spell-details {
                margin: 4px 0 0 20px;
                width: calc(100% - 30px);
                border-radius: 6px;
            }

            /* Stack spell field elements vertically */
            .spell-field {
                flex-direction: column;
            }
            
            .field-name {
                width: 100%;
                min-width: unset;
                border-right: none;
                border-bottom: 1px solid #7fb069;
                padding: 3px 5px;
                font-size: 13px;
            }

            .field-value {
                padding: 3px 5px;
                font-size: 13px;
            }

            .field-value.description {
                font-size: 12px;
            }

            /* Disable hover transforms on mobile */
            .master-category:hover {
                transform: none;
            }

            .subcategory:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <button id="collapseAll" class="collapse-button">Collapse</button>
    <div id="preparedCounter" class="prepared-counter">
        <span>Max:</span>
        <input type="number" id="spellLimit" class="spell-limit-input" value="10" min="0" max="99">
        <span id="preparedCount">0/10</span>
    </div>
    <h1 class="title">Druid Spells</h1>
    <button id="clearAll" class="clear-button">Clear All Prepared Spells</button>
    
    <div id="categories"></div>

    <script>
        // Sample JSON data structure - replace this with your converted JSON
        const jsonData = {
    "Level 0 (Cantrips)": {
        "Control Flames - Transmutation cantrip - Druid (XGE)": [
            {
                "group": "Casting TIme",
                "items": [
                    "1 action"
                ]
            },
            {
                "group": "Range",
                "items": [
                    "60 feet"
                ]
            },
            {
                "group": "Requirements",
                "items": [
                    "S"
                ]
            },
            {
                "group": "Duration",
                "items": [
                    "Instantaneous or 1 hour (see below)"
                ]
            },
            {
                "group": "Description",
                "items": [
                    "You choose nonmagical flame that you can see within range and that fits within a 5-foot cube. You affect it in one of the following ways:<br> • You instantaneously expand the flame 5 feet in one direction, provided that wood or other fuel is present in the new location.<br> • You instantaneously extinguish the flames within the cube.<br> • You double or halve the area of bright light and dim light cast by the flame, change its color or both . The change lasts for 1 hour.<br> • You cause simple shapes-such as the vague form of a creature, an inanimate object, or a location- to appear within the flames and animate as you like. The shapes last for 1 hour.<br> If you cast this spell multiple times, you can have up to three non-instantaneous effects created by it active at a time, and you can dismiss such an effect as an action."
                ]
            }
        ],
        "Create Bonfire - Conjuration cantrip - Druid (XGE)": [
            {
                "group": "Casting TIme",
                "items": [
                    "1 action"
                ]
            },
            {
                "group": "Range",
                "items": [
                    "60 feet"
                ]
            },
            {
                "group": "Requirements",
                "items": [
                    "V, S"
                ]
            },
            {
                "group": "Duration",
                "items": [
                    "Concentration, up to 1 minute"
                ]
            },
            {
                "group": "Description",
                "items": [
                    "You create a bonfire on ground that you can see within range. Until the spells ends, the magic bonfire fills a 5-foot cube. Any creature in the bonfire's space when you cast the spell must succeed on a Dexterity saving throw or take 1d8 fire damage. A creature must also make the saving throw when it enters the bonfire's space for the first time on a turn or ends its turn there.<br> The bonfire ignites flammable objects in its area that aren't being worn or carried.<br> The spell's damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8)."
                ]
            }
        ],
        "Druidcraft - Transmutation cantrip - Druid": [
            {
                "group": "Casting TIme",
                "items": [
                    "1 action"
                ]
            },
            {
                "group": "Range",
                "items": [
                    "30 feet"
                ]
            },
            {
                "group": "Requirements",
                "items": [
                    "V, S"
                ]
            },
            {
                "group": "Duration",
                "items": [
                    "Instantaneous"
                ]
            },
            {
                "group": "Description",
                "items": [
                    "Whispering to the spirits of nature, you create one of the following effects within range.<br> • You create a tiny, harmless sensory effect that predicts what the weather will be at your location for the next 24 hours. The effect might manifest as a golden orb for clear skies, a cloud for rain, falling snowflakes for snow, and so on. This effect persists for 1 round.<br> • You instantly make a flower blossom, a seed pod open, or a leaf bud bloom.<br> • You create an instantaneous, harmless sensory effect, such as falling leaves, a puff of wind, the sound of a small animal, or the faint odor of skunk. The effect must fit in a 5-foot cube.<br> • You instantly light or snuff out a candle, a torch, or a small campfire."
                ]
            }
        ],
        "Frostbite - Evocation cantrip - Druid (XGE)": [
            {
                "group": "Casting TIme",
                "items": [
                    "1 action"
                ]
            },
            {
                "group": "Range",
                "items": [
                    "60 feet"
                ]
            },
            {
                "group": "Requirements",
                "items": [
                    "V, S"
                ]
            },
            {
                "group": "Duration",
                "items": [
                    "Instantaneous"
                ]
            },
            {
                "group": "Description",
                "items": [
                    "You cause numbing frost to form on one creature that you can see within range. The target must make a Constitution saving throw. On a failed save, the target takes 1d6 cold damage, and it has disadvantage on the next weapon attack roll it makes before the end of its next turn.<br> The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
                ]
            }
        ]
    }
};

        // Track prepared spells and spell limit
        let preparedSpells = new Set();
        let spellLimit = 10;

        // localStorage functions
        function saveToLocalStorage() {
            const data = {
                preparedSpells: [...preparedSpells],
                spellLimit: spellLimit
            };
            localStorage.setItem('druidSpells', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('druidSpells');
            if (saved) {
                const data = JSON.parse(saved);
                preparedSpells = new Set(data.preparedSpells || []);
                spellLimit = data.spellLimit || 10;
                document.getElementById('spellLimit').value = spellLimit;
            }
        }

        function clearLocalStorage() {
            localStorage.removeItem('druidSpells');
            preparedSpells.clear();
            spellLimit = 10;
            document.getElementById('spellLimit').value = spellLimit;
            
            // Uncheck all checkboxes and remove prepared styling
            const checkboxes = document.querySelectorAll('.spell-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.subcategory').classList.remove('prepared');
            });
            
            updatePreparedCounter();
            updatePreparedCategory();
        }

        // Function to create spell details
        function createSpellDetails(spellData) {
            let detailsHtml = '<div class="spell-details">';
            
            spellData.forEach(field => {
                const fieldName = field.group;
                const fieldValue = field.items[0]; // Get the first (and likely only) item
                
                detailsHtml += `
                    <div class="spell-field">
                        <div class="field-name">${fieldName}</div>
                        <div class="field-value ${fieldName.toLowerCase() === 'description' ? 'description' : ''}">${fieldValue}</div>
                    </div>
                `;
            });
            
            detailsHtml += '</div>';
            return detailsHtml;
        }

        // Function to toggle visibility
        function toggleElement(element) {
            element.classList.toggle('hidden');
        }

        // Function to update prepared spells counter
        function updatePreparedCounter() {
            const counter = document.getElementById('preparedCount');
            counter.textContent = `${preparedSpells.size}/${spellLimit}`;
            
            // Add visual feedback if at limit
            if (preparedSpells.size >= spellLimit) {
                counter.style.color = '#ff9999';
            } else {
                counter.style.color = '#e8f5e8';
            }
        }

        // Function to handle spell preparation toggle
        function toggleSpellPreparation(spellName, checkbox, spellElement) {
            if (checkbox.checked) {
                // Check if at spell limit
                if (preparedSpells.size >= spellLimit) {
                    checkbox.checked = false;
                    alert(`You can only prepare ${spellLimit} spells. Increase your limit or unprepare other spells first.`);
                    return;
                }
                preparedSpells.add(spellName);
                spellElement.classList.add('prepared');
            } else {
                preparedSpells.delete(spellName);
                spellElement.classList.remove('prepared');
            }
            updatePreparedCounter();
            updatePreparedCategory();
            saveToLocalStorage();
        }

        // Function to update spell limit
        function updateSpellLimit() {
            const limitInput = document.getElementById('spellLimit');
            spellLimit = parseInt(limitInput.value) || 0;
            updatePreparedCounter();
            saveToLocalStorage();
        }

        // Function to render the spellbook
        function renderSpellbook() {
            const container = document.getElementById('categories');

            // Sort levels numerically
            const sortedLevels = Object.keys(jsonData).sort((a, b) => {
                const levelA = parseInt(a.replace('Level ', ''));
                const levelB = parseInt(b.replace('Level ', ''));
                return levelA - levelB;
            });

            sortedLevels.forEach(level => {
                // Level header (master category)
                const levelElement = document.createElement('div');
                levelElement.classList.add('master-category');
                levelElement.textContent = level;
                container.appendChild(levelElement);

                const spells = jsonData[level];
                const levelContainer = document.createElement('div');
                levelContainer.classList.add('hidden');

                // Sort spells alphabetically
                const sortedSpells = Object.keys(spells).sort();

                sortedSpells.forEach(spellName => {
                    // Spell name header (subcategory)
                    const spellElement = document.createElement('div');
                    spellElement.classList.add('subcategory');
                    
                    // Create checkbox for spell preparation
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.classList.add('spell-checkbox');
                    checkbox.id = `spell-${spellName.replace(/\s+/g, '-')}`;
                    
                    // Create content container
                    const contentDiv = document.createElement('div');
                    contentDiv.classList.add('spell-content');
                    
                    // Parse the spell name to separate the actual name from school and source
                    const parts = spellName.split(' - ');
                    if (parts.length >= 2) {
                        // Format: "Spell Name - School - Source" or "Spell Name - School"
                        const actualSpellName = parts[0];
                        const schoolAndSource = parts.slice(1).join(' - ');
                        
                        contentDiv.innerHTML = `<span class="spell-name">${actualSpellName}</span> - <span class="spell-details-text">${schoolAndSource}</span>`;
                    } else {
                        // Fallback if no dashes found
                        contentDiv.innerHTML = `<span class="spell-name">${spellName}</span>`;
                    }
                    
                    // Add checkbox and content to spell element
                    spellElement.appendChild(checkbox);
                    spellElement.appendChild(contentDiv);
                    
                    levelContainer.appendChild(spellElement);

                    // Spell details
                    const spellDetails = createSpellDetails(spells[spellName]);
                    const spellContainer = document.createElement('div');
                    spellContainer.classList.add('hidden');
                    spellContainer.innerHTML = spellDetails;

                    levelContainer.appendChild(spellContainer);

                    // Toggle spell details on content click (not checkbox)
                    contentDiv.addEventListener('click', function(e) {
                        e.stopPropagation();
                        toggleElement(spellContainer);
                    });

                    // Handle spell preparation checkbox
                    checkbox.addEventListener('change', function(e) {
                        e.stopPropagation();
                        toggleSpellPreparation(spellName, checkbox, spellElement);
                    });
                    
                    // Set checkbox state if spell is already prepared (from localStorage)
                    if (preparedSpells.has(spellName)) {
                        checkbox.checked = true;
                        spellElement.classList.add('prepared');
                    }
                });

                container.appendChild(levelContainer);

                // Toggle level on click
                levelElement.addEventListener('click', function() {
                    toggleElement(levelContainer);
                });
            });
        }

        // Function to update the prepared spells category
        function updatePreparedCategory() {
            const container = document.getElementById('categories');
            let preparedCategory = document.getElementById('preparedCategory');
            let preparedContainer = document.getElementById('preparedContainer');
            
            // Remove existing prepared category if it exists
            if (preparedCategory) {
                preparedCategory.remove();
            }
            if (preparedContainer) {
                preparedContainer.remove();
            }
            
            // Only create prepared category if there are prepared spells
            if (preparedSpells.size === 0) {
                return;
            }
            
            // Create prepared category header
            preparedCategory = document.createElement('div');
            preparedCategory.classList.add('prepared-category');
            preparedCategory.id = 'preparedCategory';
            preparedCategory.textContent = `⭐ Prepared Spells (${preparedSpells.size})`;
            container.insertBefore(preparedCategory, container.firstChild);
            
            // Create prepared container
            preparedContainer = document.createElement('div');
            preparedContainer.classList.add('hidden');
            preparedContainer.id = 'preparedContainer';
            
            // Add prepared spells to the container
            preparedSpells.forEach(spellName => {
                const spellData = findSpellData(spellName);
                if (spellData) {
                    // Create spell element (similar to regular spell display)
                    const spellElement = document.createElement('div');
                    spellElement.classList.add('subcategory', 'prepared');
                    
                    // Parse the spell name
                    const parts = spellName.split(' - ');
                    if (parts.length >= 2) {
                        const actualSpellName = parts[0];
                        const schoolAndSource = parts.slice(1).join(' - ');
                        spellElement.innerHTML = `<span class="spell-name">${actualSpellName}</span> - <span class="spell-details-text">${schoolAndSource}</span>`;
                    } else {
                        spellElement.innerHTML = `<span class="spell-name">${spellName}</span>`;
                    }
                    
                    preparedContainer.appendChild(spellElement);
                    
                    // Add spell details
                    const spellDetails = createSpellDetails(spellData.data);
                    const spellDetailContainer = document.createElement('div');
                    spellDetailContainer.classList.add('hidden');
                    spellDetailContainer.innerHTML = spellDetails;
                    preparedContainer.appendChild(spellDetailContainer);
                    
                    // Toggle spell details on click
                    spellElement.addEventListener('click', function() {
                        toggleElement(spellDetailContainer);
                    });
                }
            });
            
            container.insertBefore(preparedContainer, container.children[1]);
            
            // Toggle prepared category on click
            preparedCategory.addEventListener('click', function() {
                toggleElement(preparedContainer);
            });
        }

        // Helper function to find spell data by name
        function findSpellData(spellName) {
            for (const level in jsonData) {
                if (jsonData[level][spellName]) {
                    return {
                        level: level,
                        data: jsonData[level][spellName]
                    };
                }
            }
            return null;
        }

        // Fixed collapseAll function
        function collapseAll() {
            const container = document.getElementById('categories');
            
            // Hide the prepared container if it exists
            const preparedContainer = document.getElementById('preparedContainer');
            if (preparedContainer) {
                preparedContainer.classList.add('hidden');
            }
            
            // Hide all level containers and spell detail containers
            // These are the direct children that don't have master-category or prepared-category classes
            Array.from(container.children).forEach(child => {
                if (!child.classList.contains('master-category') && 
                    !child.classList.contains('prepared-category')) {
                    child.classList.add('hidden');
                }
            });
        }

        // Initialize the spellbook
        loadFromLocalStorage();
        renderSpellbook();
        updatePreparedCounter();
        updatePreparedCategory();

        // Add event listeners
        document.getElementById('collapseAll').addEventListener('click', collapseAll);
        document.getElementById('clearAll').addEventListener('click', function() {
            if (confirm('Clear all prepared spells? This cannot be undone.')) {
                clearLocalStorage();
            }
        });
        document.getElementById('spellLimit').addEventListener('change', updateSpellLimit);
        document.getElementById('spellLimit').addEventListener('input', updateSpellLimit);
    </script>
</body>
</html>